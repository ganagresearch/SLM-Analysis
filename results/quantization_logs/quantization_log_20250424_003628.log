2025-04-24 00:36:28,635 - INFO - [<module>] - --- System Information ---
2025-04-24 00:36:28,635 - INFO - [<module>] - Python Version: 3.11.11 (main, Dec  4 2024, 08:55:07) [GCC 11.4.0]
2025-04-24 00:36:28,635 - INFO - [<module>] - Torch Version: 2.7.0+cu126
2025-04-24 00:36:28,636 - INFO - [<module>] - Transformers Version: 4.51.3
2025-04-24 00:36:28,637 - INFO - [<module>] - Optimum Version: 1.24.0
2025-04-24 00:36:28,637 - INFO - [<module>] - ONNX Runtime Version (GPU): 1.19.2
2025-04-24 00:36:28,637 - INFO - [<module>] - Datasets Version: 3.5.0
2025-04-24 00:36:28,637 - INFO - [<module>] - CPU Count: 192
2025-04-24 00:36:28,638 - INFO - [<module>] - Total RAM: 2015.55 GB
2025-04-24 00:36:28,658 - INFO - [<module>] - GPU: NVIDIA H200
2025-04-24 00:36:28,658 - INFO - [<module>] - Total VRAM: 139.72 GB
2025-04-24 00:36:28,658 - INFO - [<module>] - CUDA Version: 12.6
2025-04-24 00:36:28,658 - INFO - [<module>] - Using Device: cuda:0
2025-04-24 00:36:28,658 - INFO - [<module>] - Quantization Batch Size: 4
2025-04-24 00:36:28,658 - INFO - [<module>] - FP32 Export Opset: 16
2025-04-24 00:36:28,658 - INFO - [<module>] - --------------------------
2025-04-24 00:36:28,658 - INFO - [<module>] - Loading calibration dataset from: /workspace/calibration_data/sevenllm_instruct_subset_manual/
2025-04-24 00:36:28,664 - INFO - [<module>] - Loaded and selected 200 calibration samples.
2025-04-24 00:36:28,664 - INFO - [<module>] - Using column 'instruction' for calibration text.
2025-04-24 00:36:28,664 - INFO - [<module>] - --- Starting Model Quantization ---
2025-04-24 00:36:28,664 - INFO - [<module>] - 
===== Processing model: Mistral-7B-Instruct-v0.3 =====
2025-04-24 00:36:28,664 - INFO - [<module>] - Input path (HF): /workspace/models/Mistral-7B-Instruct-v0.3/
2025-04-24 00:36:28,664 - INFO - [<module>] - Intermediate ONNX Export Path: /workspace/models/Mistral-7B-Instruct-v0.3/temp-fp32-onnx-export
2025-04-24 00:36:28,664 - INFO - [<module>] - Final Quantized Output Path: /workspace/models/Mistral-7B-Instruct-v0.3/
2025-04-24 00:36:28,664 - INFO - [<module>] - Trust remote code: True
2025-04-24 00:36:28,664 - INFO - [<module>] - Loading tokenizer...
2025-04-24 00:36:28,900 - WARNING - [<module>] - Tokenizer padding side is 'left'. Setting to 'right' for consistent preprocessing.
2025-04-24 00:36:28,900 - WARNING - [<module>] - Tokenizer does not have a pad token. Setting to eos_token.
2025-04-24 00:36:28,900 - INFO - [<module>] - Tokenizer loaded.
2025-04-24 00:36:28,900 - INFO - [<module>] - Starting FP32 ONNX export using torch.onnx.export (Opset: 16)...
2025-04-24 00:36:28,900 - INFO - [<module>] - Loading model for ONNX export (FP32)...
2025-04-24 00:36:39,493 - INFO - [<module>] - Moved model to cuda:0 for export.
2025-04-24 00:36:39,494 - INFO - [<module>] - Preparing dummy inputs for ONNX tracing...
2025-04-24 00:36:39,494 - INFO - [<module>] - Dummy input keys: ['input_ids', 'attention_mask', 'position_ids']
2025-04-24 00:36:39,494 - INFO - [<module>] - Expected output name: logits
2025-04-24 00:36:39,494 - INFO - [<module>] - Defined dynamic axes for inputs and output.
2025-04-24 00:36:39,494 - INFO - [<module>] - Starting torch.onnx.export to model.onnx...
2025-04-24 00:36:39,495 - ERROR - [<module>] - ERROR during processing for Mistral-7B-Instruct-v0.3: export() got an unexpected keyword argument 'use_external_data_format'
Traceback (most recent call last):
  File "/workspace/code/quantize_models.py", line 225, in <module>
    torch.onnx.export(
TypeError: export() got an unexpected keyword argument 'use_external_data_format'
2025-04-24 00:36:39,496 - WARNING - [<module>] - Attempting to unload model due to error...
2025-04-24 00:36:39,535 - INFO - [<module>] - Model unloaded after error.
2025-04-24 00:36:39,536 - WARNING - [<module>] - FP32 export failed. Attempting to clean up possibly incomplete export directory: /workspace/models/Mistral-7B-Instruct-v0.3/temp-fp32-onnx-export
2025-04-24 00:36:39,543 - INFO - [<module>] - Cleaned up failed export directory: /workspace/models/Mistral-7B-Instruct-v0.3/temp-fp32-onnx-export
2025-04-24 00:36:39,543 - INFO - [<module>] - ===== Finished processing model: Mistral-7B-Instruct-v0.3 =====
2025-04-24 00:36:39,543 - INFO - [<module>] - 
--- Model Quantization Script Finished ---
